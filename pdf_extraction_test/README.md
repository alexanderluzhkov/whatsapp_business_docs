# PDF Compensation Extraction Testing

–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö LLM –º–æ–¥–µ–ª–µ–π –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –æ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è—Ö —Ç–æ–ø-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–∞ –∏–∑ PDF –æ—Ç—á—ë—Ç–æ–≤ –∫–æ–º–ø–∞–Ω–∏–π.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üìÑ **–ü–∞—Ä—Å–∏–Ω–≥ PDF** —á–µ—Ä–µ–∑ Unstructured API —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏ (hi_res, fast, ocr_only)
- ü§ñ **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ LLM**: Claude Sonnet 4, Claude Haiku, GPT-4
- üéØ **5 —Ç–∏–ø–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤**: –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –¥–µ—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏, equity –ø–ª–∞–Ω—ã, KPI –º–µ—Ç—Ä–∏–∫–∏, –ø–æ–ª–∏—Ç–∏–∫–∏ –∏ governance
- ‚ö° **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∫ API
- üîÑ **Retry logic** —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º backoff
- üö¶ **Rate limiting** –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ API
- üìä **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**: –ø–æ–ª–Ω–æ—Ç–∞ –¥–∞–Ω–Ω—ã—Ö, —Ç–æ—á–Ω–æ—Å—Ç—å, —Å—Ç–æ–∏–º–æ—Å—Ç—å, —Å–∫–æ—Ä–æ—Å—Ç—å
- üìà **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤** –≤ Markdown –∏ JSON
- üé® **–ö—Ä–∞—Å–∏–≤—ã–π CLI** —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞–º–∏ –∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
pdf_extraction_test/
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ input/          # –ó–∞–≥—Ä—É–∑–∫–∞ PDF —Ñ–∞–π–ª–æ–≤ —Å—é–¥–∞
‚îÇ   ‚îî‚îÄ‚îÄ output/         # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –≤ JSON
‚îú‚îÄ‚îÄ prompts/            # –®–∞–±–ª–æ–Ω—ã –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è 5 —Ç–∏–ø–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ 1_basic_compensation.txt
‚îÇ   ‚îú‚îÄ‚îÄ 2_detailed_compensation.txt
‚îÇ   ‚îú‚îÄ‚îÄ 3_equity_plans.txt
‚îÇ   ‚îú‚îÄ‚îÄ 4_kpi_metrics.txt
‚îÇ   ‚îî‚îÄ‚îÄ 5_policies_governance.txt
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ parser.py       # –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Unstructured API
‚îÇ   ‚îú‚îÄ‚îÄ extractors.py   # –ö–ª–∞—Å—Å—ã –¥–ª—è Claude –∏ OpenAI API
‚îÇ   ‚îî‚îÄ‚îÄ compare.py      # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –º–æ–¥–µ–ª–µ–π
‚îú‚îÄ‚îÄ tests/              # –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ config.py           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (API –∫–ª—é—á–∏ —á–µ—Ä–µ–∑ env vars)
‚îú‚îÄ‚îÄ main.py             # CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ .env.example
‚îî‚îÄ‚îÄ README.md
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv venv

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å (Linux/Mac)
source venv/bin/activate

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å (Windows)
venv\Scripts\activate

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API –∫–ª—é—á–µ–π

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –¥–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏ API –∫–ª—é—á–∏:

```bash
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env`:

```env
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–ª—é—á–∏
ANTHROPIC_API_KEY=your_anthropic_api_key_here
OPENAI_API_KEY=your_openai_api_key_here

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–ª—é—á –¥–ª—è Unstructured API
# –ë–µ–∑ –Ω–µ–≥–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥
UNSTRUCTURED_API_KEY=your_unstructured_api_key_here
```

### 3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ü–æ–º–µ—Å—Ç–∏—Ç–µ PDF —Ñ–∞–π–ª—ã –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–æ–Ω–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤ –≤ –ø–∞–ø–∫—É `data/input/`:

```bash
cp /path/to/your/compensation_report.pdf data/input/
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –°—Ä–∞–≤–Ω–∏—Ç—å –≤—Å–µ –º–æ–¥–µ–ª–∏ –Ω–∞ –æ–¥–Ω–æ–º PDF
python main.py compare data/input/report.pdf

# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –≤ data/output/report.json –∏ data/output/report.md
```

### –ö–æ–º–∞–Ω–¥—ã CLI

#### 1. –ü–∞—Ä—Å–∏–Ω–≥ PDF

```bash
# –ü–∞—Ä—Å–∏–Ω–≥ —Å –≤—ã—Å–æ–∫–∏–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º (–º–µ–¥–ª–µ–Ω–Ω–µ–µ, —Ç–æ—á–Ω–µ–µ)
python main.py parse data/input/report.pdf --strategy hi_res

# –ë—ã—Å—Ç—Ä—ã–π –ø–∞—Ä—Å–∏–Ω–≥
python main.py parse data/input/report.pdf --strategy fast

# –õ–æ–∫–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –±–µ–∑ API
python main.py parse data/input/report.pdf --no-use-api

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–π–ª
python main.py parse data/input/report.pdf --output parsed_text.txt
```

**–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞:**
- `hi_res` - –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç OCR –∏ –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (–º–µ–¥–ª–µ–Ω–Ω–µ–µ)
- `fast` - –ë—ã—Å—Ç—Ä—ã–π –ø–∞—Ä—Å–∏–Ω–≥, —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Å–ª–æ–π PDF
- `ocr_only` - –¢–æ–ª—å–∫–æ OCR –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `auto` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

#### 2. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

```bash
# –ò–∑–≤–ª–µ—á—å –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è—Ö —Å Claude Sonnet
python main.py extract parsed_text.txt --query 1 --model claude-sonnet

# –î–µ—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ —Å GPT-4
python main.py extract parsed_text.txt --query 2 --model gpt-4

# KPI –º–µ—Ç—Ä–∏–∫–∏ —Å Claude Haiku (–¥–µ—à–µ–≤–ª–µ)
python main.py extract parsed_text.txt --query 4 --model claude-haiku
```

**–¢–∏–ø—ã –∑–∞–ø—Ä–æ—Å–æ–≤ (--query):**
- `1` - –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è—Ö (–∑–∞—Ä–ø–ª–∞—Ç–∞, –±–æ–Ω—É—Å—ã, total)
- `2` - –î–µ—Ç–∞–ª—å–Ω—ã–π breakdown –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–π (–≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
- `3` - –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ equity –ø–ª–∞–Ω—ã (RSU, PSU, –æ–ø—Ü–∏–æ–Ω—ã)
- `4` - KPI –∏ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- `5` - –ü–æ–ª–∏—Ç–∏–∫–∏ –∏ governance (clawback, stock ownership, etc.)

**–ú–æ–¥–µ–ª–∏ (--model):**
- `claude-sonnet` - Claude Sonnet 4 (–ª—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ, –¥–æ—Ä–æ–∂–µ)
- `claude-haiku` - Claude Haiku (–±—ã—Å—Ç—Ä–µ–µ, –¥–µ—à–µ–≤–ª–µ)
- `gpt-4` - GPT-4 Turbo

#### 3. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

```bash
# –°—Ä–∞–≤–Ω–∏—Ç—å –≤—Å–µ –º–æ–¥–µ–ª–∏ –Ω–∞ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
python main.py compare data/input/report.pdf

# –°—Ä–∞–≤–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
python main.py compare data/input/report.pdf --queries "1,2,3"

# –°—Ä–∞–≤–Ω–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏
python main.py compare data/input/report.pdf --no-all-models --models "claude-sonnet,gpt-4"

# –° –±—ã—Å—Ç—Ä—ã–º –ø–∞—Ä—Å–∏–Ω–≥–æ–º
python main.py compare data/input/report.pdf --strategy fast
```

#### 4. Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞

```bash
# –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ PDF –≤ –ø–∞–ø–∫–µ
python main.py batch data/input/ --queries "1,2,3" --model claude-sonnet

# –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
python main.py batch data/input/ --max-concurrent 2
```

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –ü—Ä–∏–º–µ—Ä 1: –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ–¥–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞

```bash
# –®–∞–≥ 1: –ü–∞—Ä—Å–∏–Ω–≥
python main.py parse data/input/apple_proxy_2024.pdf --strategy hi_res

# –®–∞–≥ 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö —Å –ª—É—á—à–µ–π –º–æ–¥–µ–ª—å—é
for i in {1..5}; do
    python main.py extract data/output/apple_proxy_2024_parsed.txt \
        --query $i --model claude-sonnet
done

# –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ compare –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
python main.py compare data/input/apple_proxy_2024.pdf
```

#### –ü—Ä–∏–º–µ—Ä 2: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏/–∫–∞—á–µ—Å—Ç–≤—É

```bash
# –°—Ä–∞–≤–Ω–∏—Ç—å Claude Haiku (–¥–µ—à—ë–≤—ã–π) vs Sonnet (–¥–æ—Ä–æ–≥–æ–π) –Ω–∞ –±–∞–∑–æ–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ
python main.py compare data/input/report.pdf \
    --queries "1" \
    --no-all-models \
    --models "claude-haiku,claude-sonnet"
```

#### –ü—Ä–∏–º–µ—Ä 3: Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –æ—Ç—á—ë—Ç–æ–≤

```bash
# –ü–æ–ª–æ–∂–∏—Ç—å –≤—Å–µ PDF –≤ data/input/
# –ò–∑–≤–ª–µ—á—å –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –≤—Å–µ—Ö
python main.py batch data/input/ \
    --queries "1" \
    --model claude-haiku \
    --max-concurrent 5
```

### Verbose —Ä–µ–∂–∏–º

–î–æ–±–∞–≤—å—Ç–µ `-v` –∏–ª–∏ `--verbose` –∫ –ª—é–±–æ–π –∫–æ–º–∞–Ω–¥–µ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
python main.py compare data/input/report.pdf -v
```

## –§–æ—Ä–º–∞—Ç—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### JSON —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ö–∞–∂–¥–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ JSON:

```json
{
  "model": "claude-sonnet-4-20250514",
  "query_type": 1,
  "query_name": "Basic Compensation",
  "extracted_data": {
    "company_name": "Apple Inc.",
    "fiscal_year": "2024",
    "executives": [...]
  },
  "tokens": {
    "prompt": 25000,
    "completion": 1200,
    "total": 26200
  },
  "extraction_time": 8.5,
  "cost_usd": 0.0942,
  "error": null
}
```

### Markdown –æ—Ç—á—ë—Ç—ã

–ü—Ä–∏ –∫–æ–º–∞–Ω–¥–µ `compare` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á—ë—Ç:

```markdown
# PDF Extraction Comparison Report

**PDF File:** apple_proxy_2024.pdf
**Total Extractions:** 15

## Summary by Model

### SONNET
- **Average Completeness:** 92.3%
- **Average Time:** 9.2s
- **Total Tokens:** 156,234
- **Total Cost:** $0.8234
- **Success Rate:** 5/5

### HAIKU
- **Average Completeness:** 87.1%
- **Average Time:** 4.1s
- **Total Tokens:** 142,891
- **Total Cost:** $0.1823
- **Success Rate:** 5/5

...
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü–∞—Ä—Å–∏–Ω–≥ PDF (parser.py)

- **Unstructured API**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±–ª–∞—á–Ω—ã–π API –¥–ª—è –≤—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
- **–õ–æ–∫–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥**: Fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É unstructured
- **–°—Ç—Ä–∞—Ç–µ–≥–∏–∏**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ —Å–∫–æ—Ä–æ—Å—Ç—å/–∫–∞—á–µ—Å—Ç–≤–æ
- **Rate limiting**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ API
- **Retry logic**: –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (extractors.py)

- **–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å**: `BaseExtractor` —Å –æ–±—â–µ–π –ª–æ–≥–∏–∫–æ–π
- **Claude extractor**: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è Anthropic API
- **OpenAI extractor**: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è OpenAI API
- **Rate limiting**: –û—Ç–¥–µ–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- **Retry logic**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—è—Ö
- **–†–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Å—á—ë—Ç –∑–∞—Ç—Ä–∞—Ç –Ω–∞ —Ç–æ–∫–µ–Ω—ã

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ (compare.py)

- **–ú–µ—Ç—Ä–∏–∫–∏**: –ü–æ–ª–Ω–æ—Ç–∞ –¥–∞–Ω–Ω—ã—Ö, –≤—Ä–µ–º—è, —Ç–æ–∫–µ–Ω—ã, —Å—Ç–æ–∏–º–æ—Å—Ç—å
- **–ê–≥—Ä–µ–≥–∞—Ü–∏—è**: –°–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –º–æ–¥–µ–ª—è–º
- **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**: –¢–∞–±–ª–∏—Ü—ã –∏ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- **–≠–∫—Å–ø–æ—Ä—Ç**: JSON –∏ Markdown —Ñ–æ—Ä–º–∞—Ç—ã

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ config.py

–í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –≤ `config.py`:

```python
# Rate limits (requests per minute)
ANTHROPIC_RPM=50
OPENAI_RPM=60

# Timeouts
API_TIMEOUT=120

# Token limits
MAX_INPUT_TOKENS=100000
MAX_OUTPUT_TOKENS=4096

# Retry configuration
MAX_RETRIES=3
RETRY_MIN_WAIT=1
RETRY_MAX_WAIT=60
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞—Ç—Ä–∞—Ç

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Claude Haiku –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤** - –≤ 10-20 —Ä–∞–∑ –¥–µ—à–µ–≤–ª–µ Sonnet
2. **–ë—ã—Å—Ç—Ä—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –¥–ª—è —Ç–µ—Å—Ç–æ–≤** - `--strategy fast` –≤–º–µ—Å—Ç–æ `hi_res`
3. **–õ–æ–∫–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥** - `--no-use-api` –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∑–∞—Ç—Ä–∞—Ç –Ω–∞ Unstructured
4. **Batch —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º** - `--max-concurrent 2` –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏

1. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - —É–≤–µ–ª–∏—á—å—Ç–µ `--max-concurrent`
2. **–ë—ã—Å—Ç—Ä–∞—è –º–æ–¥–µ–ª—å** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `claude-haiku` –≤–º–µ—Å—Ç–æ `claude-sonnet`
3. **–ë—ã—Å—Ç—Ä—ã–π –ø–∞—Ä—Å–∏–Ω–≥** - `--strategy fast`
4. **API –≤–º–µ—Å—Ç–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ** - –æ–±–ª–∞—á–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –æ–±—ã—á–Ω–æ –±—ã—Å—Ç—Ä–µ–µ

## –ü—Ä–∏–º–µ—Ä—ã —Å—Ç–æ–∏–º–æ—Å—Ç–∏

–ü—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–≥–æ PDF (50-100 —Å—Ç—Ä–∞–Ω–∏—Ü):

| –ú–æ–¥–µ–ª—å | –ü–∞—Ä—Å–∏–Ω–≥ | Query 1 | Query 2-5 (–∫–∞–∂–¥—ã–π) | –ò—Ç–æ–≥–æ (5 queries) |
|--------|---------|---------|-------------------|-------------------|
| Claude Sonnet | $0.02 | $0.08 | $0.12 | $0.58 |
| Claude Haiku | $0.02 | $0.01 | $0.02 | $0.11 |
| GPT-4 | $0.02 | $0.15 | $0.20 | $0.97 |

*–¶–µ–Ω—ã –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏ –ø–æ–ª–Ω–æ—Ç—ã –∏–∑–≤–ª–µ–∫–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö*

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
pytest tests/ -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest tests/ --cov=src --cov-report=html
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `logs/pdf_extraction.log` —Å —Ä–æ—Ç–∞—Ü–∏–µ–π –∫–∞–∂–¥—ã–µ 10 MB.

–§–æ—Ä–º–∞—Ç –ª–æ–≥–∞:
```
2024-01-15 14:23:45 | INFO     | src.parser:parse:123 | Parsing report.pdf with strategy: hi_res
2024-01-15 14:23:52 | INFO     | src.extractors:extract:89 | Claude extraction complete: 26200 tokens, $0.0942, 8.50s
```

## Troubleshooting

### –û—à–∏–±–∫–∞: "API key not found"

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–æ–∑–¥–∞–ª–∏ `.env` —Ñ–∞–π–ª –∏ –¥–æ–±–∞–≤–∏–ª–∏ –≤—Å–µ –∫–ª—é—á–∏:
```bash
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env –∏ –¥–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á–∏
```

### –û—à–∏–±–∫–∞: "Rate limit exceeded"

–£–º–µ–Ω—å—à–∏—Ç–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ rate limits –≤ `.env`:
```env
ANTHROPIC_RPM=30  # –£–º–µ–Ω—å—à–∏—Ç—å —Å 50 –¥–æ 30
```

### –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ PDF

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é:
```bash
# –ï—Å–ª–∏ hi_res –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
python main.py parse report.pdf --strategy ocr_only

# –ò–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥
python main.py parse report.pdf --no-use-api
```

### –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `hi_res` —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –ø–∞—Ä—Å–∏–Ω–≥–∞
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ Claude Sonnet –≤–º–µ—Å—Ç–æ Haiku
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ PDF (—Å–∫–∞–Ω—ã vs –Ω–∞—Ç–∏–≤–Ω—ã–π PDF)
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ–º–ø—Ç—ã –≤ `prompts/` –ø–æ–¥ –≤–∞—à —Ñ–æ—Ä–º–∞—Ç –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ –∑–∞–ø—Ä–æ—Å–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç: `prompts/6_your_query.txt`
2. –û–±–Ω–æ–≤–∏—Ç–µ `get_query_name()` –≤ `main.py`
3. –û–±–Ω–æ–≤–∏—Ç–µ `_get_expected_field_counts()` –≤ `compare.py`

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π LLM –º–æ–¥–µ–ª–∏

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —ç–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä –≤ `extractors.py`:
```python
class NewModelExtractor(BaseExtractor):
    async def extract(self, text, prompt, query_type, query_name):
        # –í–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
        pass
```

2. –î–æ–±–∞–≤—å—Ç–µ –≤ `ModelType` enum
3. –û–±–Ω–æ–≤–∏—Ç–µ `create_extractor()` factory

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º —Å–æ–∑–¥–∞–π—Ç–µ Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.

---

**Happy Extracting! üöÄ**
